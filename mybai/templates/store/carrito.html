{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Carrito de Compras - MYBAI</title>
  <link rel="stylesheet" href="{% static 'cssMYBAI/global.css' %}">
  <link rel="stylesheet" href="{% static 'cssMYBAI/carrito.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  {% include 'store/header.html' %}

  <!-- ============ CONTENIDO PRINCIPAL ============ -->
  <main class="cart-container">
  <div class="cart-header">
    <h2>Tu Carrito de Compras</h2>
    <p>Revisa y completa tu compra</p>
  </div>

  <div class="cart-main">
    <div class="cart-items">
      {% for item in carrito.items.all %}
      <div class="cart-item">
        <img src="{{ item.producto.imagen.url }}" alt="{{ item.producto.nombre }}">
        <div class="item-info">
          <h4>{{ item.producto.nombre }}</h4>
          <p>{{ item.producto.descripcion|truncatechars:60 }}</p>
        </div>

        <div class="item-price">
          <p>Precio: ${{ item.producto.precio }}</p>
          <p><strong>Subtotal:</strong> ${{ item.subtotal }}</p>
        </div>

        <!-- ===== CANTIDAD Y CONTROLES ===== -->
        <div class="quantity">
          <form action="{% url 'disminuir_item' item.id %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="qty-btn">−</button>
          </form>

          <span class="qty">{{ item.cantidad }}</span>

          <form action="{% url 'agregar_al_carrito' item.producto.id %}" method="post" style="display:inline;">
            {% csrf_token %}
            <input type="hidden" name="cantidad" value="1">
            <button type="submit" class="qty-btn">+</button>
          </form>

          <form action="{% url 'eliminar_item' item.id %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="delete-btn"><i class="fas fa-trash"></i></button>
          </form>
        </div>
      </div>
      {% empty %}
      <p>No hay productos en tu carrito.</p>
      {% endfor %}
    </div>

    <!-- ===== RESUMEN DE COMPRA ===== -->
    <div class="summary">
      <h3>Resumen de compra</h3>
      <div class="line"><span>Subtotal</span><span>${{ carrito.total }}</span></div>
      <div class="line"><span>Envío</span><span>Gratis</span></div>
      <div class="total"><span>Total:</span><span>${{ carrito.total }}</span></div>
      <a href="{% url 'checkout' %}" class="continue">Finalizar compra</a>
    </div>
  </div>

  <div class="pedido-card">
    <h3>¿Ya realizaste tu compra?</h3>
    <p>Consulta o actualiza el estado de tus pedidos</p>
    <a href="{% url 'ver_pedidos' %}"><button>Ver mis pedidos</button></a>
  </div>
</main>

  {% include 'store/footer.html' %}
</body>
</html>
